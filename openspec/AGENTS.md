# OpenSpec 工作流程指南

## 什麼是 OpenSpec？

OpenSpec 是一個**規格驅動開發框架**，專為 AI 程式設計工具（如 Cursor、Claude Code）和人類開發者協作設計。核心理念是：**讓需求清晰可見，讓實現有據可查**。

## 工作流程（4 個步驟）

### 1. 起草提案（Proposal）

**目的**：在編寫程式碼之前，明確定義要做什麼、為什麼做、以及影響範圍。

**檔案**：`openspec/changes/[change-id]/proposal.md`

**內容應包括**：
- **為什麼**（Why）：變更的原因和背景
- **改什麼**（What）：具體要實現的功能或修改
- **影響範圍**（Impact）：會影響哪些模組、功能或使用者
- **非目標**（Non-goals）：明確不包含的內容

**如何建立**：
- 在 Cursor 中使用命令：`/opsx:new`
- 或手動在 `openspec/changes/` 下建立新目錄和 `proposal.md` 檔案

### 2. 審查對齊（Review）

**目的**：在實施前確認規格無誤，確保開發者和 AI 對需求理解一致。

**活動**：
- 審查 `proposal.md` 的內容
- 與團隊成員討論（如果有）
- 確認需求清晰且完整
- 如有需要，修改提案

### 3. 實施任務（Tasks）

**目的**：將提案拆解為具體的、可執行的任務清單。

**檔案**：`openspec/changes/[change-id]/tasks.md`

**內容應包括**：
- 任務列表（通常按順序排列）
- 每個任務應該是：
  - 具體可執行的
  - 時間可控（建議每個任務不超過 2 小時）
  - 有明確的完成標準

**如何建立**：
- 在 Cursor 中使用命令：`/opsx:continue`
- AI 會根據 `proposal.md` 自動產生任務清單
- 您可以手動編輯和調整任務

### 4. 實施和歸檔（Apply & Archive）

**目的**：根據任務清單實施程式碼，完成後歸檔變更。

**實施**：
- 在 Cursor 中使用命令：`/opsx:apply`
- AI 會根據 `tasks.md` 逐步實現功能
- 您可以審查每個任務的實現

**歸檔**：
- 完成後，規格檔案會合併到 `openspec/specs/` 目錄
- 變更歷史保存在 `openspec/changes/archive/`
- `openspec/specs/` 成為系統的**單一真理來源**（Single Source of Truth）

## 目錄結構

```
openspec/
├── changes/              # 進行中的工作
│   ├── [change-id]/      # 每個變更的目錄
│   │   ├── proposal.md   # 提案
│   │   └── tasks.md      # 任務清單
│   └── archive/          # 已完成的工作歷史
├── specs/                # 系統當前狀態（單一真理來源）
│   └── [spec-files].md   # 歸檔後的規格檔案
├── config.yaml           # OpenSpec 配置
├── project.md            # 專案上下文（本文件）
└── AGENTS.md             # 工作流程指南（本檔案）
```

## 與 AI 協作的最佳實踐

### 1. 使用斜線命令

OpenSpec 在 Cursor 中提供了以下命令：

- `/opsx:new` - 開始新的變更（建立提案）
- `/opsx:continue` - 建立下一個工件（通常是任務清單）
- `/opsx:apply` - 實施任務（讓 AI 根據任務清單實現程式碼）

### 2. 保持規格檔案更新

- 如果實施過程中發現需求變化，及時更新 `proposal.md` 或 `tasks.md`
- 確保規格檔案反映真實的系統狀態

### 3. 審查 AI 產生的程式碼

- AI 會根據規格產生程式碼，但您應該：
  - 審查程式碼是否符合專案約定
  - 檢查是否有遺漏或錯誤
  - 執行測試確保功能正常

### 4. 迭代改進

- 如果某個任務太大，可以進一步拆解
- 如果發現新的需求，可以建立新的變更提案

## 範例工作流

假設您要新增「使用者登入功能」：

1. **建立提案**：
   ```
   /opsx:new
   ```
   然後描述：為什麼需要登入功能、要實現哪些功能、會影響哪些模組

2. **產生任務清單**：
   ```
   /opsx:continue
   ```
   AI 會產生類似這樣的任務：
   - 建立使用者模型和資料庫表
   - 實現註冊 API 端點
   - 實現登入 API 端點
   - 建立登入頁面 UI
   - 新增 JWT 認證中介軟體
   - 編寫測試

3. **實施任務**：
   ```
   /opsx:apply
   ```
   AI 會逐步實現每個任務

4. **審查和歸檔**：
   - 測試功能
   - 審查程式碼
   - 完成後歸檔到 `specs/`

## 優勢

- ✅ **減少返工**：在實施前明確需求，減少約 40% 的返工
- ✅ **提高協作效率**：AI 和開發者對需求理解一致
- ✅ **可追溯性**：所有變更都有清晰的規格文件
- ✅ **漸進式採用**：可以逐步為專案新增規格，無需重構現有程式碼

## 取得幫助

- 官方文件：https://github.com/Fission-AI/OpenSpec
- 問題回饋：https://github.com/Fission-AI/OpenSpec/issues
